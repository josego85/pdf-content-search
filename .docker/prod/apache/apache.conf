ServerRoot "/usr/local/apache2"
Listen 80

LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule status_module modules/mod_status.so
LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule rewrite_module modules/mod_rewrite.so
# Performance: Compression modules
LoadModule deflate_module modules/mod_deflate.so
LoadModule brotli_module modules/mod_brotli.so
# Performance: Cache control
LoadModule expires_module modules/mod_expires.so
# Performance: HTTP/2
LoadModule http2_module modules/mod_http2.so

<IfModule unixd_module>
    User daemon
    Group daemon
</IfModule>

ServerAdmin you@example.com
ServerName localhost

# Security: Hide server information
ServerTokens Prod
ServerSignature Off

# Enable HTTP/2
Protocols h2 h2c http/1.1

<Directory />
    AllowOverride none
    Require all denied
</Directory>

DocumentRoot "/var/www/html/public"
<Directory "/var/www/html/public">
    # Security: Disable directory listing in production
    Options FollowSymLinks
    AllowOverride All
    Require all granted
    DirectoryIndex index.php
</Directory>

ErrorLog /proc/self/fd/2
# Production: Only log errors
LogLevel error

LogFormat "%h %l %u %t \"%r\" %>s %b" common
CustomLog /proc/self/fd/1 common

# ============================================
# Performance: Brotli Compression (Production)
# ============================================
<IfModule mod_brotli.c>
    # Enable Brotli for these MIME types
    AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css text/javascript
    AddOutputFilterByType BROTLI_COMPRESS application/javascript application/json application/xml
    AddOutputFilterByType BROTLI_COMPRESS image/svg+xml

    # Production: Maximum compression quality for best bandwidth savings
    # 11 = best compression (slower, but cached on CDN/browser)
    BrotliCompressionQuality 11

    # Advanced: Compression window (10-24, larger = better compression)
    BrotliCompressionWindow 22
</IfModule>

# ============================================
# Performance: Gzip Fallback (if Brotli unavailable)
# ============================================
<IfModule mod_deflate.c>
    <IfModule !mod_brotli.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
        AddOutputFilterByType DEFLATE application/javascript application/json application/xml
        AddOutputFilterByType DEFLATE image/svg+xml

        # Compression level 9 (maximum)
        DeflateCompressionLevel 9
    </IfModule>
</IfModule>

# ============================================
# Performance: Aggressive Cache Headers (Production)
# ============================================
<IfModule mod_expires.c>
    ExpiresActive On

    # Webpack versioned files (app.abc123.js) - Cache forever with immutable
    <FilesMatch "\.[0-9a-f]{8}\.(js|css)$">
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>

    # Regular JS/CSS (fallback for non-versioned files)
    <FilesMatch "\.(js|css)$">
        ExpiresDefault "access plus 1 month"
        Header set Cache-Control "public, max-age=2592000"
    </FilesMatch>

    # Images and fonts - 1 year
    <FilesMatch "\.(jpg|jpeg|png|gif|svg|ico|webp|woff|woff2|ttf|eot)$">
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>

    # PDF files - 1 week (pueden actualizarse)
    <FilesMatch "\.pdf$">
        ExpiresDefault "access plus 1 week"
        Header set Cache-Control "public, max-age=604800"
    </FilesMatch>

    # HTML - No cache (siempre fresco)
    <FilesMatch "\.(html|htm)$">
        ExpiresDefault "access plus 0 seconds"
        Header set Cache-Control "no-cache, must-revalidate"
    </FilesMatch>
</IfModule>

# ============================================
# Security: Additional Headers
# ============================================
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Enable XSS protection
    Header always set X-XSS-Protection "1; mode=block"

    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"

    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

Include conf/extra/httpd-vhosts.conf
