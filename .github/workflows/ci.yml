name: CI

on:
  push:
    branches:
      - main
      - develop
      - 'feature/**'
      - 'claude/**'
  pull_request:
    branches:
      - main
      - develop

permissions:
  contents: read

jobs:
  php-tests:
    name: PHP Tests (PHP ${{ matrix.php }})
    runs-on: ubuntu-latest
    if: false  # Temporarily disabled - no tests implemented yet

    strategy:
      fail-fast: false
      matrix:
        php: ['8.4']

    steps:
      - name: Checkout code
        uses: actions/checkout@71cf2267d89c5cb81562390fa70a37fa40b1305e # v5.0.0

      - name: Setup PHP project
        uses: ./.github/actions/setup-php-project
        with:
          php-version: ${{ matrix.php }}
          extensions: 'ctype, iconv, pdo, pdo_pgsql'

      - name: Validate composer files
        run: composer validate --strict

      - name: Run PHPUnit tests
        run: vendor/bin/phpunit --testdox

  code-style:
    name: PHP Code Style
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@71cf2267d89c5cb81562390fa70a37fa40b1305e # v5.0.0

      - name: Setup PHP project
        uses: ./.github/actions/setup-php-project

      - name: Run PHP-CS-Fixer
        run: composer cs-check

  frontend-build:
    name: Frontend Build & Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@71cf2267d89c5cb81562390fa70a37fa40b1305e # v5.0.0

      - name: Setup Node.js project
        uses: ./.github/actions/setup-node-project

      - name: Build frontend assets
        run: npm run build

      - name: Verify build artifacts
        run: |
          if [ ! -d "public/build" ]; then
            echo "Build directory not found!"
            exit 1
          fi
          echo "Build completed successfully"
