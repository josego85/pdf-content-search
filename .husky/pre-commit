#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check if Docker containers are running
if ! docker compose ps | grep -q "Up"; then
  echo "âš ï¸  Docker containers are not running. Start them with: docker compose up -d"
  exit 1
fi

echo "ğŸ” Running PHP-CS-Fixer check..."
docker compose exec -T php composer cs-check

if [ $? -ne 0 ]; then
  echo "âŒ Code style violations detected. Please fix them before committing."
  exit 1
fi

echo "âœ… PHP code style is clean."
echo ""

echo "ğŸ§ª Running PHP tests..."
docker compose exec -T php bash -c "XDEBUG_MODE=coverage php bin/phpunit"

if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix them before committing."
  exit 1
fi

echo "âœ… PHP tests passed."
echo ""

echo "ğŸ¨ Running JavaScript/Vue linter..."
docker compose exec -T php npm run lint

if [ $? -ne 0 ]; then
  echo "âŒ Linting errors detected. Please fix them before committing."
  exit 1
fi

echo "âœ… JavaScript/Vue code is clean."
echo ""

echo "âœ¨ All checks passed. Proceeding with commit."
